# Install instructions:
# 1. Run /tmp/install_xdebug.sh manually on the app server.
# 2. Restart the app server.

#commands:
#    01_xdebug_install:
#        cwd: /tmp
#        command: |
#            /tmp/install_xdebug.sh

files:
  "/tmp/xdebug.ini":
    mode: "000644"
    owner: root
    group: root
    content: |
      zend_extension = /usr/lib64/php/modules/xdebug.so
      xdebug.remote_enable=1
      xdebug.remote_port=9000
      xdebug.remote_host="127.0.0.1"
      xdebug.remote_autostart=off
      xdebug.idekey="xdebug_session"
      # Uncomment the following to allow Xdebug connections to the server.
      #xdebug.remote_connect_back=0
      #xdebug.remote_mode=req
  "/tmp/install_xdebug.sh":
    mode: "000744"
    owner: root
    group: root
    content: |
      #!/bin/bash

      wget https://xdebug.org/files/xdebug-3.1.2.tgz -O xdebug-3.1.2.tgz \
      && tar -xvzf xdebug-3.1.2.tgz \
      && cd xdebug-3.1.2 \
      && phpize \
      && ./configure \
      && make \
      && cp modules/xdebug.so /usr/lib64/php/modules

      cp /tmp/xdebug.ini /etc/php.d/

