commands:
    01_xdebug_install:
        cwd: /tmp
        command: |
            /tmp/install_xdebug.sh

files:
  "/tmp/xdebug.ini":
    mode: "000644"
    owner: root
    group: root
    content: |
      zend_extension = /usr/lib64/php/7.3/modules/xdebug.so
      xdebug.remote_enable=1
      xdebug.remote_port=9000
      xdebug.remote_host="127.0.0.1"
      xdebug.remote_autostart=off
      xdebug.idekey="xdebug_session"
      # Uncomment the following to allow Xdebug connections to the server.
      #xdebug.remote_connect_back=0
      #xdebug.remote_mode=req
  "/tmp/install_xdebug.sh":
    mode: "000744"
    owner: root
    group: root
    content: |
      #!/bin/bash

      . /opt/elasticbeanstalk/support/envvars

      if [ "true" != "$XDEBUG_ENABLED" ]; then
        echo "Skipping Xdebug installation. (XDEBUG_ENABLED = $XDEBUG_ENABLED)"
      else
        wget https://xdebug.org/files/xdebug-2.8.0.tgz -O xdebug-2.8.0.tgz \
        && tar -xvzf xdebug-2.8.0.tgz \
        && cd xdebug-2.8.0 \
        && phpize \
        && ./configure \
        && make \
        && cp modules/xdebug.so /usr/lib64/php/7.3/modules

        cp /tmp/xdebug.ini /etc/php-7.3.d/
      fi
  "/tmp/install_xdebug_post.sh":
    mode: "000744"
    owner: root
    group: root
    content: |
      /sbin/service httpd restart

container_commands:
    01_reload_server:
        command: /tmp/install_xdebug_post.sh

